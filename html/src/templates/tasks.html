<div class="col-md-10 col-centered" ng-controller="TaskListCtl">
    <div class="row list-header">
        <h2>Tasks</h2>
        <div class="list-actions">
            <button ng-click="newTaskConf.addingTask = true" type="button" class="btn btn-success btn-sm">New</button>
            <button ng-click="data.refreshTasks()" type="button" class="btn btn-info btn-sm">Refresh List</button>
        </div>
    </div>
    <div class="row create-item-area" ng-if="newTaskConf.addingTask">
        <form class="form-horizontal">
            <div class="form-group">
                <label for="newTaskType" class="col-sm-2 control-label">New Task Type</label>
                <div class="col-sm-10">
                    <select 
                        class="form-control" 
                        id="newTaskType" 
                        ng-model="newTaskConf.newTaskType" 
                        ng-change="newTaskConf.changedTaskType()"
                        ng-options="taskType.name for taskType in data.taskTypes">
                    </select>
                </div>
            </div>
        </form>

        <form class="form-horizontal" ng-if="newTaskConf.newTaskType" name="newTaskForm">
            <hr/>

            <div class="form-group">
                <label for="newTaskSettings" class="col-sm-2 control-label">Environment Settings</label>
                <div class="col-sm-10">
                    <table class="table table-condensed row-centered">
                        <thead>
                            <tr>
                                <th>Setting</th>
                                <th>Value</th>
                                <th>Description</th>
                                <th>Type</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- List default values -->
                            <tr 
                                ng-repeat="item in newTaskConf.newTaskType.environment.default track by item.name" 
                                class="like-sm-input active">
                                <td>{{ item.name }}</td>
                                <td>{{ item.value }}</td>
                                <td>{{ item.description }}</td>
                                <td><span class="label label-default">Default</span></td>
                                <td></td>
                            </tr>

                            <!-- List required / optional / user added values -->
                            <tr 
                                class="like-sm-input"
                                ng-repeat="item in newTaskConf.newTask.environment"
                                ng-class="(!item.required || newTaskForm[item.name + '_value'].$valid) ? '' : 'warning' ">
                                <td>
                                    <input type="text" class="form-control input-sm" placeholder="setting" ng-model="item.name" ng-disabled="item.required">
                                </td>
                                <td>
                                    <input 
                                        type="text" 
                                        class="form-control input-sm" 
                                        name="{{ item.name }}_value"
                                        placeholder="value" 
                                        ng-model="item.value"
                                        ng-required="item.required"
                                        >
                                </td>
                                <td>{{ item.description }}</td>
                                <td>
                                    <span class="label label-primary" ng-if="item.required" >Required</span>
                                    <span class="label label-default" ng-if="!item.required" >Optional</span>
                                </td>
                                <td>
                                    <a class="danger" ng-if="!item.required" ng-click="newTaskConf.removeParam($index)">Remove</a>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
                <div class="col-sm-offset-10 col-sm-2 pull-right">
                    <button type="button" class="btn btn-sm pull-right" ng-click="newTaskConf.addParam()">Add setting</button>
                </div>
            </div>

            <!-- Submit -->
            <hr/>
            <div class="form-group">
                <div class="col-sm-offset-8 col-sm-4 pull-right">
                    <button 
                        type="submit" 
                        class="btn btn-success btn-sm stacked-right" 
                        ng-click="newTaskConf.launchTask()"
                        ng-disabled="!newTaskForm.$valid">
                        Launch Task
                    </button>
                    <button type="submit" class="btn btn-danger btn-sm stacked-right" ng-click="newTaskConf.addingTask = false">Cancel</button>
                    <button type="submit" class="btn btn-sm stacked-right" ng-click="newTaskConf.changedTaskType()">Reset</button>
                </div>
            </div>
        </form>
    </div>
    <table class="table table-condensed row-centered">
        <thead> 
            <tr>
                <th>#</th>
                <th>Id</th>
                <th>Type</th>
                <th>Tags</th>
                <th>Date Created</th>
                <th>Date Started</th>
                <th>Date Last Updated</th>
                <th>State</th>
                <th>Results</th>
                <th>Actions</th>
            </tr> 
        </thead>
        <tbody>
            <tr ng-repeat="task in data.tasks track by task.id">
                <th scope="row">{{ ($index+1) }}</th>
                <td><a ng-href="/#/task/{{task.id}}">{{ task.id | limitTo: 8 }}</a></td>
                <td><a ng-href="{{baseUrl}}/task_type/{{task.type}}">{{ task.type }}</a></td>
                <td>{{ task.tags.join(', ') }}</td>
                <td>{{ task.createdTs | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                <td ng-if="task.startedTs === 0" >None</td>
                <td ng-if="task.startedTs !== 0" >{{ task.startedTs | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                <td>{{ task.lastUpdatedTs | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                <td> <span class="label label-{{ task.labelClass }}">{{ task.state }}</span> </td>
                <td ng-if="task.hasResults === true" ><a ng-href="{{baseUrl}}/results/{{task.id}}">Results</a></td>
                <td ng-if="task.hasResults === false" >None</td>
                <td>
                    <a class="danger" ng-click="data.stopTask(task)">{{ getStopCommand(task) }}</a>
                </td>
            </tr>
        </tbody>
    </table>
</div> <!-- End TaskListCtl -->