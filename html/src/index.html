<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Blanket UI</title>
    <meta name="description" content="User interface for working with Blanket">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/lib/common.min.js"></script>
    <script src="js/app/app.min.js"></script>
</head>
<body ng-app="blanketApp">
    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <nav class="navbar navbar-default" ng-controller="NavCtl">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-10 col-centered">
                    <div class="navbar-header">
                      <a class="navbar-brand" href="#">
                        Blanket UI
                      </a>
                    </div>
                    <p class="navbar-text navbar-right">
                        Autorefresh?  <input type="checkbox" ng-model="autoRefresh" ng-change="toggleAutoRefresh()">
                        | Current Time: {{ lastRefreshed | date:'yyyy/MM/dd HH:mm:ss a' }}
                    </p>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-10 col-centered" ng-controller="TaskListCtl">
                <h2>Tasks</h2>
                <table class="table table-condensed">
                    <thead> 
                        <tr>
                            <th>#</th>
                            <th>Id</th>
                            <th>Type</th>
                            <th>Tags</th>
                            <th>Date Created</th>
                            <th>Date Started</th>
                            <th>Date Last Updated</th>
                            <th>State</th>
                            <th>Results</th>
                        </tr> 
                    </thead>
                    <tbody ng-repeat="task in data.tasks">
                        <tr>
                            <th scope="row">{{ ($index+1) }}</th>
                            <td><a ng-href="{{baseUrl}}/task/{{task.id}}">{{ task.id | limitTo: 8 }}</a></td>
                            <td><a ng-href="{{baseUrl}}/task_type/{{task.type}}">{{ task.type }}</a></td>
                            <td>{{ task.tags.join(', ') }}</td>
                            <td>{{ task.createdTs | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                            <td ng-if="task.startedTs === 0" >None</td>
                            <td ng-if="task.startedTs !== 0" >{{ task.startedTs | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                            <td>{{ task.lastUpdatedTs | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                            <td> <span class="label label-{{ task.labelClass }}">{{ task.state }}</span> </td>
                            <td ng-if="task.hasResults === true" ><a ng-href="{{baseUrl}}/results/{{task.id}}">Results</a></td>
                            <td ng-if="task.hasResults === false" >None</td>
                        </tr>
                    </tbody>
                </table>

                <h2>Task Types</h2>
                <table class="table table-condensed">
                    <thead> 
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Tags</th>
                            <th>Date Loaded</th>
                            <th>Config File</th>
                            <th>Current Version</th>
                        </tr> 
                    </thead>
                    <tbody ng-repeat="taskType in data.taskTypes">
                        <tr>
                            <th scope="row">{{ ($index+1) }}</th>
                            <td><a ng-href="{{baseUrl}}/task_type/{{taskType.name}}">{{ taskType.name }}</a></td>
                            <td>{{ taskType.tags.join(', ') }}</td>
                            <td>{{ taskType._loaded_ts | date:'yyyy/MM/dd HH:mm:ss a' }}</td>
                            <td> {{ taskType._config_file }} </td>
                            <td> {{ taskType._version_hash }} </td>
                        </tr>
                    </tbody>
                </table>

            </div> <!-- End TaskListCtl -->
        </div>
    </div>

</body>
